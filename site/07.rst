##################################
유튜브 익스텐션 개발하기
##################################

이제 간단한 익스텐션을 개발해보겠습니다. 기능은 간단한 문법으로 유튜브 영상을 콘텐츠에 포함할 수 있는 익스텐션입니다. 이 익스텐션을 구현하기 전에 필요한 API부터 확인해 보겠습니다.

================
codeBlockManager
================

**codeBlockManager** 은 마크다운 코드의 코드블럭에 관련된 기능들이 모여있는 모듈입니다. 우리는 마크다운 코드블럭의 변환 코드를 확장해 코드블럭이 유튜브 영상으로 변환되도록 만들 것입니다. 이런 작업을 해주는 API는 **codeBlockManger** 의 **setReplacer** 메서드입니다. 마크다운 코드블럭의 사용 언어 파트에 "youtube"를 입력하면 코드블럭 내부의 코드를 주소로 사용해 유튜브 영상으로 교체하는 리플레이서를 만들어 **setReplacer** 로 추가합니다. 이전에 **index.js** 에 정의한 익스텐션을 아래와 같이 수정해서 리플레이서의 간단한 동작을 확인합니다.

에디터의 생성 옵션 **exts** 에서 이름을 'youtube'로 수정하는 것을 잊지 마세요~

.. code-block:: javascript                

  Editor.defineExtension('youtube', () => {
    Editor.codeBlockManager.setReplacer('youtube', code => `play youtube id: ${code}`);
  });

  const editor = new Editor({
    ...,
    exts: ['youtube']
  });

그리고 브라우저가 리프레시되면 익스텐션이 동작하는지 한번 확인하고 에디터의 마크다운 모드에서  코드블럭을 만들어 봅니다. 

.. code-block:: md

  ```youtube
  HELLO WORLD
  ```

그리고 프리뷰 창을 확인합니다. 마크다운 코드블럭이 입력한 내용이 익스텐션에 의해 변환되어 출력됩니다. 이제 유튜브 동영상으로 변환해 봅니다!

사실 유튜브 동영상은 iframe으로 쉽게 삽입할 수 있지만 보안 이슈로 TOAST UI 에디터는 iframe을 모두 제거합니다. 그래서 div를 하나 만들고 다음 프레임에 iframe을 추가합니다.

.. code-block:: javascript

  Editor.defineExtension('youtube', () => {
    Editor.codeBlockManager.setReplacer('youtube', youtubeId => {
      const wrapperId = `yt${Math.random().toString(36).substr(2, 10)}`;
      setTimeout(renderYoutube.bind(null, wrapperId, youtubeId), 0);
      
      return `<div id="${wrapperId}"></div>`;
    });
  });

  function renderYoutube(wrapperId, youtubeId) {
    const el = document.querySelector(`#${wrapperId}`);
    el.innerHTML = `<iframe width="420" height="315" src="https://www.youtube.com/embed/${youtubeId}"></iframe>`;
  }

그리고 브라우저를 열어 에디터에 코드블럭을 수정합니다.

.. code-block:: md
                
  ```youtube
  XGSy3_Czz8k
  ```  
                
그리고 프리뷰창을 확인하면 유튜브 영상이 나올 것입니다. 축하합니다. TOAST UI Editor의 첫 익스텐션을 완성했습니다!

